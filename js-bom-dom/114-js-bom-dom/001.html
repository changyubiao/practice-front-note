<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>114-动画-一个简单例子</title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}

			div {
				margin-top: 50px;
				/* color: #FF0000; */
				width: 100px;
				height: 100px;
				background-color: #FF0000;
				position: absolute;
				left: 0;
			}
		</style>
	</head>
	<body>
		<!-- 
	动画：
			
			
			原生的 简单定时器动画 
			
			
			运动对象
			
			
			起始状态
				对象本身
				样式
				样式的值
			
			时间跨度：
			
				步骤数

			*/
 
 -->

		<input type="text" name="" id="pos" value="100" />
		<input type="button" name="" id="btn" value="向前移动" />
		<div id="div1">
		</div>


		<script type="text/javascript">
			var btn = document.querySelector('#btn');

			// 5 秒
			// 3. 时间的跨度: duration
			// 时间的间隔: interval
			const duration = 5000;
			const interval = 20;

			// var  div = document.querySelector('#div1');
			btn.addEventListener('click', function() {
				// 运动的对象 #div1
				var div = document.querySelector('#div1');


				// 起始点 :  #div1  当前位置的 left 
				// 终止点 :   #div1 #pos  
				// 不能用 , 拿不到 left 
				// var leftStart = div.style.left;


				var leftStart = div.offsetLeft;
				console.log('left:', leftStart);


				var leftEnd = parseInt(document.querySelector('#pos').value);

				console.log('leftEnd:', leftEnd);
				console.log('typeof:', typeof leftEnd);

				// 时间跨度: 常数 5s 
				// 时间间隔, 常数 20ms 

				// 设置定时器 
				// 9. timer 在闭包中 需要有方法 把 timer 干掉
				var timer = setInterval(function() {

						let stepTemp = (leftEnd - leftStart) / (duration / interval);
						let step = Math.floor(stepTemp);

						// step 必须是 整数,且不能是0 
						if (step === 0) {
							step = stepTemp > 0 ? 1 : -1;
						}

						// console.log('step:', step);
						// console.log(div.style.left, leftEnd);

						console.log('timer:', timer, 'step:', step,
							'div.offsetLeft - leftEnd:', div.offsetLeft - leftEnd);


						// 定时器什么时候停止 
						// div.style.left <= leftEnd

						// 同时考虑 向左 和向右移动
						// if (step * (div.offsetLeft - leftEnd) <= 0) {
						// 最后一次 不足一个step 如何处理  ？
						// 如何解决 lefEnd 位置不精确的问题
						if (Math.abs((leftEnd - div.offsetLeft)) <= step) {
							div.style.left = leftEnd + 'px';
							clearInterval(timer);
						} else {
							div.style.left = (div.offsetLeft + step) + 'px';
						}

						// } else {
						// 	// 停止定时器
						// 	console.log('clear Interval...')
						// 	console.log(div.offsetLeft, leftEnd);
						// 	// clearInterval(timer);
						// }

					},
					interval);

			});
			// 
			//  这个时候 还是有点问题，  回去的时候 会出去。。。。一直往左 跑
			// hour:81
		</script>


	</body>
</html>
